// @strict-types


#Область ОписаниеПеременных

#КонецОбласти

#Область ОбработчикиСобытийФормы

// Код процедур и функций


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Склад") Тогда 
		Склад = Параметры.Склад;
	КонецЕсли;
	ОбновитьСписокДоступныхКниг();
КонецПроцедуры
#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

// Код процедур и функций

#КонецОбласти

#Область ОбработчикиКомандФормы

// Код процедур и функций


&НаКлиенте
Процедура Добавить(Команда)
	Выбор = Новый Массив;
	
	Для каждого ТекущаяСтрока Из ОстатокКнигНаСкладе Цикл
		Если ТекущаяСтрока.Выбрать Тогда
			Выбор.Добавить(ТекущаяСтрока);
		КонецЕсли;
					
	КонецЦикла;
	
	ОповеститьОВыборе(Выбор);
	
КонецПроцедуры
#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ОбновитьСписокДоступныхКниг()
	
	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ
		|	ОстаткиНомеклатурыОстатки.Книга,
		|	ОстаткиНомеклатурыОстатки.КоличествоОстаток КАК Количество
		|ПОМЕСТИТЬ Вт_Остатки
		|ИЗ
		|	РегистрНакопления.ОстаткиНомеклатуры.Остатки КАК ОстаткиНомеклатурыОстатки
		|ГДЕ
		|	ОстаткиНомеклатурыОстатки.Склад = &Склад
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПрайсЛистСрезПоследних.Книга,
		|	ПрайсЛистСрезПоследних.Склад,
		|	ПрайсЛистСрезПоследних.РозничнаяЦена
		|ПОМЕСТИТЬ ВТ_РозничныеЦены
		|ИЗ
		|	РегистрСведений.ПрайсЛист.СрезПоследних(, Склад = &Склад) КАК ПрайсЛистСрезПоследних
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вт_Остатки.Книга,
		|	Вт_Остатки.Количество,
		|	ВТ_РозничныеЦены.РозничнаяЦена
		|ИЗ
		|	Вт_Остатки КАК Вт_Остатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РозничныеЦены КАК ВТ_РозничныеЦены
		|		ПО ВТ_РозничныеЦены.Книга = Вт_Остатки.Книга";
	
	Запрос.УстановитьПараметр("Склад", Склад);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		НоваяСтрока = ОстатокКнигНаСкладе.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, ВыборкаДетальныеЗаписи);
	КонецЦикла;
	
		
КонецПроцедуры
#КонецОбласти
